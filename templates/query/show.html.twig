{% extends 'layout.html.twig' %}

{% block content_header %}
    <section class="content-header">
        <h1>
            <i class="fa fa-plus-circle" aria-hidden="true"></i>
            Query
        </h1>
        <ol class="breadcrumb">
            <li><a href="{{ url('query_index') }}"><i class="fa fa-dashboard"></i> Queries</a></li>
            <li class="active">Show Query</li>
        </ol>
    </section>
{% endblock %}

{% block content %}

        <div class="col-md-12 col-sm-6 col-xs-12">
            <div class="box box-primary">

                {% for label, messages in app.flashes(['success', 'error']) %}
                    {% for message in messages %}
                        <div class="alert alert-{{ label }} alert-dismissable">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endfor %}

                <div class="x_content">
                    <div class="box-body">

                        {% if query.account %}
                            <div class="box box-widget widget-user-2">

                                <div class="row">
                                    <div class="col-md-6">
                                        <!-- Add the bg color to the header using any of the bg-* classes -->
                                        <div class="widget-user-header bg-yellow">
                                            <h3 class="widget-user-username">{{ query.account.name }} {% if query.account.country is defined %}{{ countries[query.account.country] }}{% else %} - {% endif %}</h3>
                                        </div>
                                        <div class="box-footer no-padding">
                                            <ul class="nav nav-stacked">
                                                <li><a href="#">Id: <span class="pull-right badge bg-blue">{{ query.id }}</span></a></li>
                                                <li><a href="#">Name: <span class="pull-right">{% if query.account.name is defined %}{{ query.account.name }}{% else %} - {% endif %}</span></a></li>
                                                <li><a href="#">Manager: <span class="pull-right">{% if query.account.manager is defined %}{{ query.account.manager }}{% else %} - {% endif %}</span></a></li>
                                                <li><a href="#">Sport: <span class="pull-right">{% if query.account.sport is defined %}{{ query.account.sport }}{% else %} - {% endif %}</span></a></li>
                                                <li><a href="#">Country: <span class="pull-right">{% if query.account.country is defined %}{{ countries[query.account.country] }}{% else %} - {% endif %}</span></a></li>
                                                <li><a href="#">Arrival: <span class="pull-right">{% if query.dateOfArrival is defined %}{{ query.dateOfArrival|date('Y-m-d H:i') }}{% else %} - {% endif %}</span></a></li>
                                                <li><a href="#">Departure: <span class="pull-right">{% if query.dateOfDeparture is defined %}{{ query.dateOfDeparture|date('Y-m-d H:i') }}{% else %} - {% endif %}</span></a></li>
                                            </ul>
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <!-- Add the bg color to the header using any of the bg-* classes -->
                                        <div class="widget-user-header bg-red">
                                            <h3 class="widget-user-username">Meal Schedule</h3>
                                        </div>
                                        <div class="box-footer no-padding">
                                                {% if query.account.mealSchedules|length > 0%}
                                                <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap table-hover" cellspacing="0">
                                                    <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Restaurant</th>
                                                        <th>Breakfast</th>
                                                        <th>Lunch</th>
                                                        <th>Dinner</th>
                                                        <th>Middle Breakfast</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {#{% for meal in query.account.mealSchedules %}#}
                                                    {% for date, meals in mealArray %}
                                                            <tr>
                                                                <td>
                                                                    {{ date }}
                                                                </td>
                                                                <td>
                                                                    {% for meal in meals %}
                                                                        {{ constant('App\\Entity\\Query::RESTAURANTS')[meal.restaurant] }}<br>
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for meal in meals %}
                                                                        {% if meal.breakfastTime %}
                                                                            {{ meal.breakfastTime|date('H:i') }} <br>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for meal in meals %}
                                                                        {% if meal.lunchTime %}
                                                                            {{ meal.lunchTime|date('H:i') }} <br>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for meal in meals %}
                                                                        {% if meal.dinnerTime %}
                                                                            {{ meal.dinnerTime|date('H:i') }} <br>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for meal in meals %}
                                                                        {% if meal.middleBreakfastTime %}
                                                                            {{ meal.middleBreakfastTime|date('H:i') }} <br>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </td>
                                                            </tr>
                                                    {% else %}
                                                        No meal Schedule
                                                    {% endfor %}

                                                    </tbody>
                                                </table>
                                                {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <!-- Add the bg color to the header using any of the bg-* classes -->
                                        <div class="widget-user-header bg-green">
                                            <h3 class="widget-user-username">Facility Schedule</h3>
                                        </div>
                                        <div class="box-footer no-padding">
                                            {% if query.account.schedules|length > 0%}
                                                <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap table-hover" cellspacing="0">
                                                    <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Facility</th>
                                                        <th>From</th>
                                                        <th>To</th>
                                                        <th>Parts</th>
                                                        <th>Additional Info</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for date, schedules in scheduleArray %}
                                                        <tr>
                                                            <td>
                                                                {{ date }}
                                                            </td>
                                                            <td>
                                                                {% for schedule in schedules %}
                                                                    {{ schedule.facility.name }} <br>
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for schedule in schedules %}
                                                                    {% if schedule.timeFrom %}
                                                                        {{ schedule.timeFrom|date('H:i') }} <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for schedule in schedules %}
                                                                    {% if schedule.timeTo %}
                                                                        {{ schedule.timeTo|date('H:i') }} <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for schedule in schedules %}
                                                                    {{ constant('App\\Entity\\Facility::PARTS')[schedule.facility.type][schedule.parts] }} <br>
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for schedule in schedules %}
                                                                    {% if schedule.lanes is not null %}
                                                                        Lanes number:
                                                                        {% for lane in schedule.lanes|unserialize|keys %}
                                                                            {{ lane }},
                                                                        {% endfor %}
                                                                        <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </td>
                                                        </tr>
                                                    {% else %}
                                                        No Schedule
                                                    {% endfor %}

                                                    </tbody>
                                                </table>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                            </div>
                        {% endif %}
                        <div class="box-footer">
                            <div>
                                <a href="{{ path('query_index') }}" class="btn bg-green">
                                    <i class="fa fa-arrow-circle-left"></i><span class="hidden-xs hidden-sm"> Back to the list</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>






            </div>

        </div>

        <div class="col-md-5 col-sm-6 col-xs-12">

{% endblock %}